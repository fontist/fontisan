# Font Validation Rules Configuration
#
# This file defines validation rules for different font types and validation levels.
# The rules determine which checks are performed and their severity thresholds.

# Required tables for different font types
required_tables:
  # Tables required for all fonts
  all:
    - head
    - name
    - cmap
    - maxp
    - hhea
    - hmtx
    - post
    - OS/2

  # Additional tables required for TrueType fonts (.ttf)
  truetype:
    - glyf
    - loca

  # Additional tables required for OpenType/CFF fonts (.otf)
  opentype_cff:
    - CFF   # or CFF2 for CFF2 format

  # Additional tables required for variable fonts
  variable:
    - fvar
    - gvar  # For TrueType variable fonts
    - HVAR  # Horizontal metrics variations (optional but recommended)
    - MVAR  # Metrics variations (optional)

# Validation levels define which checks to perform
validation_levels:
  # Strict: All checks must pass, no warnings allowed
  strict:
    check_required_tables: true
    check_table_checksums: true
    check_head_checksum_adjustment: true
    check_glyph_consistency: true
    check_cmap_references: true
    check_hmtx_consistency: true
    check_name_consistency: true
    check_variable_consistency: true
    check_table_offsets: true
    check_table_ordering: false  # Not critical for correctness
    allow_warnings: false
    allow_info: true

  # Standard: Most checks enabled, warnings allowed
  standard:
    check_required_tables: true
    check_table_checksums: true
    check_head_checksum_adjustment: true
    check_glyph_consistency: true
    check_cmap_references: true
    check_hmtx_consistency: true
    check_name_consistency: true
    check_variable_consistency: true
    check_table_offsets: true
    check_table_ordering: false
    allow_warnings: true
    allow_info: true

  # Lenient: Basic checks only, many warnings allowed
  lenient:
    check_required_tables: true
    check_table_checksums: false  # Skip checksum validation
    check_head_checksum_adjustment: false
    check_glyph_consistency: true
    check_cmap_references: false  # Skip cmap validation
    check_hmtx_consistency: true
    check_name_consistency: false
    check_variable_consistency: false
    check_table_offsets: true
    check_table_ordering: false
    allow_warnings: true
    allow_info: true

# Error messages templates
error_messages:
  missing_table: "Missing required table: %{table}"
  invalid_table_checksum: "Table '%{table}' checksum mismatch (expected: %{expected}, got: %{actual})"
  invalid_head_checksum: "Invalid head table checksum adjustment"
  glyph_count_mismatch: "Glyph count mismatch: maxp=%{maxp}, actual=%{actual}"
  invalid_cmap_reference: "cmap references non-existent glyph ID %{glyph_id}"
  hmtx_count_mismatch: "hmtx entries (%{hmtx}) don't match glyph count (%{glyph_count})"
  invalid_table_offset: "Table '%{table}' has invalid offset: %{offset}"
  variable_table_missing: "Variable font missing required table: %{table}"
  fvar_gvar_mismatch: "fvar axis count (%{fvar}) doesn't match gvar axis count (%{gvar})"

# Warning messages templates
warning_messages:
  table_checksum_mismatch: "Table '%{table}' checksum mismatch"
  suboptimal_table_order: "Tables not in optimal order for performance"
  missing_optional_table: "Optional table '%{table}' not present (recommended for %{reason})"
  name_inconsistency: "Name table inconsistency: %{issue}"
  large_font_size: "Font file size (%{size} bytes) is unusually large"

# Info messages templates
info_messages:
  optimization_opportunity: "Font could benefit from %{optimization}"
  subsetting_recommended: "Font contains %{glyph_count} glyphs; subsetting may reduce size"
  compression_recommended: "Font could benefit from WOFF2 compression"

# Checksum validation settings
checksum_validation:
  # Magic number for checksum adjustment calculation
  magic: 0xB1B0AFBA

  # Tables exempt from checksum validation (some tables have dynamic content)
  skip_tables:
    - DSIG  # Digital signature table (changes with signing)

# Consistency checks configuration
consistency_checks:
  # Maximum acceptable glyph ID for cmap validation
  max_glyph_id_multiplier: 2.0  # Allow up to 2x maxp.numGlyphs for safety

  # Minimum acceptable glyph count
  min_glyph_count: 1

  # Maximum acceptable glyph count (sanity check)
  max_glyph_count: 65536

# Structure validation settings
structure_validation:
  # Minimum valid offset (after header and directory)
  min_table_offset: 12

  # Table alignment requirement (4-byte alignment)
  table_alignment: 4

  # Maximum reasonable table size (100MB)
  max_table_size: 104857600

# Variable font specific validation
variable_validation:
  # Check that all required variation tables are consistent
  check_axis_consistency: true

  # Check that variation regions are valid
  check_region_validity: true

  # Check that deltas are within reasonable bounds
  max_delta_value: 32767
  min_delta_value: -32768