= Fontisan: Font analysis tools and utilities

image:https://img.shields.io/gem/v/fontisan.svg[RubyGems Version, link=https://rubygems.org/gems/fontisan]
image:https://img.shields.io/github/license/fontist/fontisan.svg[License]
image:https://github.com/fontist/fontisan/actions/workflows/test.yml/badge.svg[Build Status, link=https://github.com/fontist/fontisan/actions/workflows/test.yml]

== Purpose

Fontisan is a Ruby gem providing font analysis tools and utilities.

It is designed as a pure Ruby implementation with full object-oriented
architecture, supporting extraction of information from OpenType and TrueType
fonts (OTF, TTF, TTC).

The gem provides both a Ruby library API and a command-line interface, with
structured output formats (YAML, JSON, text) via lutaml-model.

Fontisan is designed to replace the following tools:

* `otfinfo` from http://www.lcdf.org/type/[LCDF Typetools]. Fontisan supports
all features provided by `otfinfo`, including extraction of font metadata,
OpenType tables, glyph names, Unicode mappings, variable font axes, optical size
information, supported scripts, OpenType features, and raw table dumps.

* `extract_ttc` from https://github.com/fontist/extract_ttc[ExtractTTC].
Fontisan fully supersedes extract_ttc with Docker-like commands (`ls`, `info`,
`unpack`) that work on both collections and individual fonts. Fontisan provides
all `extract_ttc` functionality plus comprehensive font analysis, subsetting,
validation, format conversion, and collection creation. See
link:docs/EXTRACT_TTC_MIGRATION.md[extract_ttc Migration Guide] for detailed
command mappings and usage examples.


== Installation

Add this line to your application's Gemfile:

[source,ruby]
----
gem "fontisan"
----

And then execute:

[source,shell]
----
bundle install
----

Or install it yourself as:

[source,shell]
----
gem install fontisan
----

== Features

* Extract comprehensive font metadata (name, version, designer, license, etc.)
* List OpenType tables with checksums and offsets
* Extract glyph names from post table
* Display Unicode codepoint to glyph index mappings
* Analyze variable font axes and named instances
* Display optical size information
* List supported scripts from GSUB/GPOS tables
* List OpenType features (ligatures, kerning, etc.) by script
* Dump raw binary table data for analysis
* Support for OTF, TTF, and TTC font formats
* Command-line interface with full otfinfo parity
* Ruby library API for programmatic access
* Structured output in YAML, JSON, and text formats


== Usage

=== Command-line interface

==== Font information

Extract comprehensive metadata from font files. This includes font names,
version information, designer credits, vendor details, licensing information,
and font metrics.

Syntax:

[source,shell]
----
$ fontisan info FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.Font information for Libertinus Serif Regular
[example]
====
[source,shell]
----
$ fontisan info spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf

Font type:                TrueType
Family:                   Libertinus Serif
Subfamily:                Regular
Full name:                Libertinus Serif Regular
PostScript name:          LibertinusSerif-Regular
Version:                  Version 7.051;RELEASE
Unique ID:                5.000;QUE ;LibertinusSerif-Regular
Designer:                 Philipp H. Poll, Khaled Hosny
Manufacturer:             Caleb Maclennan
Vendor URL:               https://github.com/alerque/libertinus
Vendor ID:                QUE
License Description:      This Font Software is licensed under the SIL Open Font
                          License, Version 1.1. This license is available with a
                          FAQ at: https://openfontlicense.org
License URL:              https://openfontlicense.org
Font revision:            7.05099
Permissions:              Installable
Units per em:             1000
----
====


.Output in structured YAML format
[example]
====
[source,shell]
----
$ fontisan info spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf --format yaml
----

[source,yaml]
----
font_format: truetype
is_variable: false
family_name: Libertinus Serif
subfamily_name: Regular
full_name: Libertinus Serif Regular
postscript_name: LibertinusSerif-Regular
version: Version 7.051;RELEASE
unique_id: 5.000;QUE ;LibertinusSerif-Regular
designer: Philipp H. Poll, Khaled Hosny
manufacturer: Caleb Maclennan
vendor_url: https://github.com/alerque/libertinus
vendor_id: QUE
license_description: 'This Font Software is licensed under the SIL Open Font License,
  Version 1.1. This license is available with a FAQ at: https://openfontlicense.org'
license_url: https://openfontlicense.org
font_revision: 7.050994873046875
permissions: Installable
units_per_em: 1000
----
====


==== List OpenType tables

Display the font's table directory, showing all OpenType tables with their
sizes, offsets, and checksums. Useful for understanding font structure and
verifying table integrity.

Syntax:

[source,shell]
----
$ fontisan tables FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`

.List of OpenType tables in Libertinus Serif Regular
[example]
====
[source,shell]
----
$ fontisan tables spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf
----

[source,text]
----
SFNT Version: TrueType (0x00010000)
Number of tables: 16

Tables:
  GDEF         834 bytes  (offset: 542156, checksum: 0x429C5C0C)
  GPOS       17870 bytes  (offset: 542992, checksum: 0x29CE4200)
  OS/2          96 bytes  (offset: 392, checksum: 0x4830F1C3)
  cmap        3620 bytes  (offset: 11412, checksum: 0x03AD3899)
  cvt          248 bytes  (offset: 18868, checksum: 0x3098127E)
  fpgm        3596 bytes  (offset: 15032, checksum: 0x622F0781)
  gasp           8 bytes  (offset: 542148, checksum: 0x00000010)
  glyf      484900 bytes  (offset: 30044, checksum: 0x0FF34594)
  head          54 bytes  (offset: 268, checksum: 0x18F5BDD0)
  hhea          36 bytes  (offset: 324, checksum: 0x191E2264)
  hmtx       10924 bytes  (offset: 488, checksum: 0x1F9D892B)
  loca       10928 bytes  (offset: 19116, checksum: 0x230B1A58)
  maxp          32 bytes  (offset: 360, checksum: 0x0EF919E7)
  name         894 bytes  (offset: 514944, checksum: 0x4E9173E6)
  post       26308 bytes  (offset: 515840, checksum: 0xE3D70231)
  prep         239 bytes  (offset: 18628, checksum: 0x8B4AB356)
----
====

.Output in structured YAML format
[example]
====
[source,shell]
----
$ fontisan tables spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf --format yaml
----

[source,yaml]
----
---
sfnt_version: TrueType (0x00010000)
num_tables: 16
tables:
- tag: GDEF
  length: 834
  offset: 542156
  checksum: 1117543436
- tag: GPOS
  length: 17870
  offset: 542992
  checksum: 701383168
- tag: OS/2
  length: 96
  offset: 392
  checksum: 1211167171
- tag: cmap
  length: 3620
  offset: 11412
  checksum: 61683865
- tag: 'cvt '
  length: 248
  offset: 18868
  checksum: 815272574
- tag: fpgm
  length: 3596
  offset: 15032
  checksum: 1647249281
----
====

==== List glyph names

Show all glyph names defined in the font's post table. Each glyph is listed with
its index and name, useful for understanding the font's character coverage.

Syntax:

[source,shell]
----
$ fontisan glyphs FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.List of glyph names in Libertinus Serif Regular
[example]
====
[source,shell]
----
$ fontisan glyphs spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf
----

[source,text]
----
Glyph count: 2731
Source: post_2.0

Glyph names:
      0  .notdef
      1  space
      2  exclam
      3  quotedbl
      4  numbersign
      5  dollar
      6  percent
      7  ampersand
      8  quotesingle
      9  parenleft
     10  parenright
     11  asterisk
     12  plus
     13  comma
     14  hyphen
     15  period
     16  slash
     17  zero
     18  one
     19  two
     20  three
     ...
----
====

==== Show Unicode mappings

Display Unicode codepoint to glyph index mappings from the cmap table. Shows
which glyphs are assigned to which Unicode characters.

Syntax:

[source,shell]
----
$ fontisan unicode FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.Unicode to glyph mappings in Libertinus Serif Regular
[example]
====
[source,shell]
----
$ fontisan unicode spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf
----

[source,text]
----
Unicode mappings: 2382

U+0020  glyph 1  space
U+0021  glyph 2  exclam
U+0022  glyph 3  quotedbl
U+0023  glyph 4  numbersign
U+0024  glyph 5  dollar
U+0025  glyph 6  percent
U+0026  glyph 7  ampersand
U+0027  glyph 8  quotesingle
U+0028  glyph 9  parenleft
U+0029  glyph 10  parenright
U+002A  glyph 11  asterisk
U+002B  glyph 12  plus
U+002C  glyph 13  comma
U+002D  glyph 14  hyphen
U+002E  glyph 15  period
U+002F  glyph 16  slash
U+0030  glyph 17  zero
U+0031  glyph 18  one
...
----
====

==== Variable font information

Display variation axes and named instances for variable fonts. Shows the design
space and predefined styles available in the font.

Syntax:

[source,shell]
----
$ fontisan variable FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the variable font file
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.Variable font axes and instances in Mona Sans
[example]
====
[source,shell]
----
$ fontisan variable spec/fixtures/fonts/MonaSans/variable/MonaSans[wdth,wght].ttf
----

[source,text]
----
Axis 0:                 wdth
Axis 0 name:            Width
Axis 0 range:           75 125
Axis 0 default:         100
Axis 1:                 wght
Axis 1 name:            Weight
Axis 1 range:           200 900
Axis 1 default:         400
Instance 0 name:        Mona Sans Narrow Thin
Instance 0 position:    75 200
Instance 1 name:        Mona Sans Narrow ExtraLight
Instance 1 position:    75 250
Instance 2 name:        Mona Sans Narrow Light
Instance 2 position:    75 300
...
----
====

==== Optical size information

Display optical size range from the OS/2 table for fonts designed for specific
point sizes.

Syntax:

[source,shell]
----
$ fontisan optical-size FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file with optical sizing
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.Optical size information in Libertinus Serif Display
[example]
====
[source,shell]
----
$ fontisan optical-size spec/fixtures/fonts/libertinus/ttf/LibertinusSerifDisplay-Regular.ttf
----

[source,text]
----
Size range: [18, 72) pt  (source: OS/2_usLowerOpticalPointSize)
----
====

==== List supported scripts

Show all scripts (writing systems) supported by the font, extracted from GSUB
and GPOS tables. Useful for understanding language coverage.

Syntax:

[source,shell]
----
$ fontisan scripts FONT_FILE [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.Supported scripts in Libertinus Serif Regular
[example]
====
[source,shell]
----
$ fontisan scripts spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf
----

[source,text]
----
Script count: 5

DFLT  Default
cyrl  Cyrillic
grek  Greek
hebr  Hebrew
latn  Latin
----
====

==== List OpenType features

Show OpenType layout features (typography features like ligatures, kerning,
small capitals) available for specific scripts or all scripts.

Syntax:

[source,shell]
----
$ fontisan features FONT_FILE [--script SCRIPT] [--format FORMAT]
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`SCRIPT`:: Optional 4-character script tag (e.g., `latn`, `cyrl`, `arab`). If not specified, shows features for all scripts
`FORMAT`:: Output format: `text` (default), `json`, or `yaml`


.OpenType features for Latin script
[example]
====
[source,shell]
----
$ fontisan features spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf --script latn
----

[source,text]
----
Script: latn
Feature count: 4

cpsp  Capital Spacing
kern  Kerning
mark  Mark Positioning
mkmk  Mark to Mark Positioning
----
====


.OpenType features for all scripts
[example]
====
[source,shell]
----
$ fontisan features spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf
----

[source,text]
----
Script: DFLT
Feature count: 4

  cpsp  Capital Spacing
  kern  Kerning
  mark  Mark Positioning
  mkmk  Mark to Mark Positioning

Script: cyrl
Feature count: 4

  cpsp  Capital Spacing
  kern  Kerning
  mark  Mark Positioning
  mkmk  Mark to Mark Positioning

Script: grek
Feature count: 4

  cpsp  Capital Spacing
  kern  Kerning
  mark  Mark Positioning
  mkmk  Mark to Mark Positioning

Script: hebr
Feature count: 2

  mark  Mark Positioning
  mkmk  Mark to Mark Positioning

Script: latn
Feature count: 4

  cpsp  Capital Spacing
  kern  Kerning
  mark  Mark Positioning
  mkmk  Mark to Mark Positioning
----
====

==== Dump raw table data

Extract raw binary data from a specific OpenType table. Useful for detailed
analysis or debugging font issues.

Syntax:

[source,shell]
----
$ fontisan dump-table FONT_FILE TABLE_TAG
----

Where,

`FONT_FILE`:: Path to the font file (OTF, TTF, or TTC)
`TABLE_TAG`:: Four-character table tag (e.g., `name`, `head`, `GSUB`, `GPOS`)


.Dump raw table data to files
[example]
====
[source,shell]
----
$ fontisan dump-table spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf name > name_table.bin
$ fontisan dump-table spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf GPOS > gpos_table.bin
$ fontisan dump-table spec/fixtures/fonts/libertinus/ttf/LibertinusSerif-Regular.ttf head > head_table.bin
----

The output is binary data written directly to stdout, which can be redirected to a file for further analysis.
====

==== General options

All commands support these options:

`--format FORMAT`:: Output format: `text` (default), `json`, or `yaml`

`--font-index INDEX`:: Font index for TTC files (default: 0)

`--verbose`:: Enable verbose output

`--quiet`:: Suppress non-error output

==== Version information

Display the Fontisan version:

[source,shell]
----
fontisan version
----


==== Font collections

===== List fonts

List all fonts in a TrueType Collection (TTC) or OpenType Collection (OTC), with
their index, family name, and style.

[source,shell]
----
$ fontisan ls FONT.{ttc,otc}
----

NOTE: In `extract_ttc`, this was done with `extract_ttc --list FONT.ttc`.


.List collection contents
[example]
====
[source,shell]
----
# List all fonts in a TTC with detailed info
$ fontisan ls spec/fixtures/fonts/NotoSerifCJK/NotoSerifCJK.ttc

Font 0: Noto Serif CJK JP
  Family: Noto Serif CJK JP
  Subfamily: Regular
  PostScript: NotoSerifCJKJP-Regular

Font 1: Noto Serif CJK KR
  Family: Noto Serif CJK KR
  Subfamily: Regular
  PostScript: NotoSerifCJKKR-Regular

Font 2: Noto Serif CJK SC
  Family: Noto Serif CJK SC
  Subfamily: Regular
  PostScript: NotoSerifCJKSC-Regular

Font 3: Noto Serif CJK TC
  Family: Noto Serif CJK TC
  Subfamily: Regular
  PostScript: NotoSerifCJKTC-Regular
----
====


===== Show collection info

Show detailed information about a TrueType Collection (TTC), OpenType Collection
(OTC), including the number of fonts and metadata for each font.

[source,shell]
----
$ fontisan info FONT.{ttc,otc}
----

NOTE: In `extract_ttc`, this was done with `extract_ttc --info FONT.ttc`.

.Get collection information
[example]
====
[source,shell]
----
# Detailed collection analysis
$ fontisan info spec/fixtures/fonts/NotoSerifCJK/NotoSerifCJK.ttc --format yaml

---
collection_type: ttc
font_count: 4
fonts:
- index: 0
  family_name: Noto Serif CJK JP
  subfamily_name: Regular
  postscript_name: NotoSerifCJKJP-Regular
  font_format: opentype
- index: 1
  family_name: Noto Serif CJK KR
  subfamily_name: Regular
  postscript_name: NotoSerifCJKKR-Regular
  font_format: opentype
- index: 2
  family_name: Noto Serif CJK SC
  subfamily_name: Regular
  postscript_name: NotoSerifCJKSC-Regular
  font_format: opentype
- index: 3
  family_name: Noto Serif CJK TC
  subfamily_name: Regular
  postscript_name: NotoSerifCJKTC-Regular
  font_format: opentype
----
====

===== Unpack fonts

Extract all fonts from a TrueType Collection (TTC) or OpenType Collection (OTC)
to a specified output directory.

[source,shell]
----
$ fontisan unpack FONT.{ttc,otc} OUTPUT_DIR
----

NOTE: In `extract_ttc`, this was done with `extract_ttc --unpack FONT.ttc OUTPUT_DIR`.

===== Extract specific font

Extract a specific font from a TrueType Collection (TTC) or OpenType Collection (OTC) by its index.

[source,shell]
----
$ fontisan unpack FONT.{ttc,otc} --font-index INDEX OUTPUT.{ttf,otf}
----

NOTE: In `extract_ttc`, this was done with `extract_ttc --font-index INDEX FONT.ttc OUTPUT.ttf`.

.Extract with validation
[example]
====
[source,shell]
----
# Extract and validate simultaneously
$ fontisan unpack spec/fixtures/fonts/NotoSerifCJK/NotoSerifCJK.ttc extracted_fonts/ --validate

Extracting font 0: Noto Serif CJK JP → extracted_fonts/NotoSerifCJKJP-Regular.ttf
Extracting font 1: Noto Serif CJK KR → extracted_fonts/NotoSerifCJKKR-Regular.ttf
Extracting font 2: Noto Serif CJK SC → extracted_fonts/NotoSerifCJKSC-Regular.ttf
Extracting font 3: Noto Serif CJK TC → extracted_fonts/NotoSerifCJKTC-Regular.ttf

Validation: All fonts extracted successfully
----
====

===== Validate collection

Validate the structure and checksums of a TrueType Collection (TTC) or OpenType
Collection (OTC).

[source,shell]
----
$ fontisan validate FONT.{ttc,otc}
----

NOTE: In `extract_ttc`, this was done with `extract_ttc --validate FONT.ttc`.
=======
==== Advanced Features Beyond extract_ttc

Fontisan provides capabilities that extract_ttc never had:

.Font analysis and inspection
* Extract OpenType tables with checksums and offsets
* Display Unicode mappings and glyph names
* Analyze variable font axes and instances
* Show supported scripts and OpenType features
* Dump raw binary table data

.Format conversion and subsetting
* Convert between TTF, OTF, WOFF, and WOFF2 formats
* Create font subsets with specific glyph ranges
* Validate font structure and integrity
* Generate SVG representations of glyphs

.Collection creation
* Build new TTC files from individual fonts
* Optimize collection with table deduplication
* Pack fonts with shared tables for smaller file sizes

For complete migration guide, see link:docs/EXTRACT_TTC_MIGRATION.md[extract_ttc Migration Guide].

==== CLI Examples for Advanced Features

===== Collection Creation and Management

.Create TTC collection from multiple fonts
[source,shell]
----
# Pack fonts into TTC with table sharing optimization
$ fontisan pack font1.ttf font2.ttf font3.ttf --output family.ttc --analyze

Collection Analysis:
Total fonts: 3
Shared tables: 12
Potential space savings: 45.2 KB
Table sharing: 68.5%

Collection created successfully:
  Output: family.ttc
  Format: TTC
  Fonts: 3
  Size: 245.8 KB
  Space saved: 45.2 KB
  Sharing: 68.5%
----

.Create OTC collection from OpenType fonts
[source,shell]
----
$ fontisan pack Regular.otf Bold.otf Italic.otf --output family.otc --format otc
----

.Extract fonts from collection
[source,shell]
----
# Extract all fonts from collection
$ fontisan unpack family.ttc --output-dir extracted/

Collection unpacked successfully:
  Input: family.ttc
  Output directory: extracted/
  Fonts extracted: 3/3
  - font1.ttf (89.2 KB)
  - font2.ttf (89.2 KB)
  - font3.ttf (67.4 KB)

# Extract specific font with format conversion
$ fontisan unpack family.ttc --output-dir extracted/ --font-index 0 --format woff2
----

===== Format Conversion

.Convert TTF to WOFF2 for web usage
[source,shell]
----
$ fontisan convert font.ttf --to woff2 --output font.woff2

Converting font.ttf to woff2...
Conversion complete!
  Input:  font.ttf (245.8 KB)
  Output: font.woff2 (89.2 KB)
----

.Convert to SVG format
[source,shell]
----
$ fontisan convert font.ttf --to svg --output font.svg

Converting font.ttf to svg...
Conversion complete!
  Input:  font.ttf (245.8 KB)
  Output: font.svg (1.2 MB)
----

===== Font Subsetting

.Create PDF-optimized subset
[source,shell]
----
$ fontisan subset font.ttf --text "Hello World" --output subset.ttf --profile pdf

Subset font created:
  Input: font.ttf
  Output: subset.ttf
  Original glyphs: 1253
  Subset glyphs: 12
  Profile: pdf
  Size: 12.4 KB
----

.Subset with Unicode ranges
[source,shell]
----
$ fontisan subset font.ttf --unicode "U+0041-U+005A,U+0061-U+007A" --output latin.ttf
----

===== Font Validation

.Validate font with different levels
[source,shell]
----
# Standard validation (allows warnings)
$ fontisan validate font.ttf

# Strict validation (no warnings allowed)
$ fontisan validate font.ttf --level strict

# Detailed validation report
$ fontisan validate font.ttf --format yaml
----

===== Variable Font Instances

.Generate static instance from variable font
[source,shell]
----
# Create bold instance
$ fontisan instance variable.ttf --wght=700 --output bold.ttf

# Use named instance
$ fontisan instance variable.ttf --named-instance="Bold" --output bold.ttf

# List available instances
$ fontisan instance variable.ttf --list-instances
----

===== Advanced Font Analysis

.Dump raw table data for analysis
[source,shell]
----
$ fontisan dump-table font.ttf name > name_table.bin
$ fontisan dump-table font.ttf GPOS > gpos_table.bin
----

.Analyze font structure
[source,shell]
----
# List all OpenType tables with details
$ fontisan tables font.ttf --format yaml

# Show variable font information
$ fontisan variable font.ttf

# Display optical size information
$ fontisan optical-size font.ttf
----

.Get comprehensive font information
[source,shell]
----
# Basic font info
$ fontisan info font.ttf

# Scripts and features analysis
$ fontisan scripts font.ttf
$ fontisan features font.ttf --script latn

# Unicode coverage
$ fontisan unicode font.ttf

# Glyph names
$ fontisan glyphs font.ttf
----

== Copyright and license

Copyright Ribose.

Fontisan is licensed under the Ribose 3-Clause BSD License. See the LICENSE file
for details.
